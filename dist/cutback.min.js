!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Cutback={})}(this,function(e){"use strict";class t{constructor(e={}){this.initialized=!1,this.timelines=new Map,this.timelinesArray=[],this.timelinesName=[],this.timelinesToRegister={},this.elementsToRegister=[],this.animationFrames=[],this.bannerType="in-page",this.expand=!1,this.finalExpandSize=[0,0,0,0],this.startExpanded=!1,this.hotspotClose=[],this.hotspotExpand=[],!1!==e.autoInit&&window.addEventListener("load",()=>{this.initializeBanner(e)})}setConfig(e){this.bannerType=e.bannerType||"in-page",this.expand=e.expand||!1,this.finalExpandSize=e.finalExpandSize||[0,0,0,0],this.startExpanded=e.startExpanded||!1,this.elementsToRegister=e.elementsToRegister||[],this.hotspotClose=e.hotspotClose||[],this.hotspotExpand=e.hotspotExpand||[],this.timelinesName=e.timelinesName||[],this.timelinesToRegister=e.timelinesToRegister||{},this.animationFrames=e.animationFrames||[],this.initialized=!0}initializeBanner(e){this.initialized?console.log("Already initialized"):(this.setConfig(e),this.addListeners(),this.registerTimelines(),this.executeAnimations())}addListeners(){for(const e of this.elementsToRegister){const{eventType:t,element:i,handler:n}=e;if("function"==typeof n)if("."===i.charAt(0)){const e=document.querySelectorAll(i);for(const i of e)i.addEventListener(t,n)}else{const e=document.querySelector(i);e&&e.addEventListener(t,n)}else console.warn(`Handler for element "${i}" is not a function`)}this.expand&&this.setupExpandListeners()}setupExpandListeners(){if(0!==this.hotspotExpand.length){const e=this.hotspotExpand[1]||"click",t=document.querySelector(this.hotspotExpand[0]);t&&t.addEventListener(e,()=>this.expandEvent())}else console.warn("Please add the hotspotExpand");if("in-app"!==this.bannerType)if(0!==this.hotspotClose.length){const e=this.hotspotClose[1]||"click",t=document.querySelector(this.hotspotClose[0]);t&&t.addEventListener(e,()=>this.collapseEvent())}else console.warn("Please add the hotspotClose")}registerTimelines(){const e="undefined"!=typeof TimelineMax?TimelineMax:"undefined"!=typeof gsap&&gsap.timeline?gsap.timeline:null;if(e){for(const t of this.timelinesName){const i="function"==typeof e&&"TimelineMax"===e.name?new e:e();this.timelines.set(t,i),this.timelinesArray.push(i),window[t]=i}"function"==typeof this.timelinesToRegister.register&&this.timelinesToRegister.register();for(const e of this.timelinesArray)e.pause()}else console.warn("GSAP TimelineMax or gsap.timeline not found")}executeAnimations(){this.animationFrames.length>0&&"function"==typeof this.animationFrames[0]&&this.animationFrames[0]()}expandEvent(){"function"==typeof this.timelinesToRegister.expandStartAnimation&&this.timelinesToRegister.expandStartAnimation()}collapseEvent(){"function"==typeof this.timelinesToRegister.collapseStartAnimation&&this.timelinesToRegister.collapseStartAnimation()}resetWhenCloseOrExit(){const e="undefined"!=typeof TweenMax?TweenMax:"undefined"!=typeof gsap?gsap:null;if(!e)return void console.warn("GSAP TweenMax or gsap not found");const t=[".banner > div",".banner > span",".banner > p",".banner > h1",".banner > h2",".banner > h3",".banner > h4",".banner > a",".banner > input",".banner > canvas"];for(const i of t)e.set(i,{clearProps:"all"});for(const e of this.timelinesArray)e.seek(0).pause();this.executeAnimations()}getTimeline(e){return this.timelines.get(e)}getTimelineNames(){return Array.from(this.timelines.keys())}}class i extends t{constructor(e={}){super({...e,autoInit:!1}),this.doubleClickTracking=!0,window.addEventListener("load",()=>{this.initializeBanner(e)})}setConfig(e){super.setConfig(e),this.doubleClickTracking=!1!==e.doubleClickTracking}initializeBanner(e){this.initialized?console.log("Already initialized"):(this.setConfig(e),this.doubleClickTracking?(this.initializeDoubleClick(),this.registerTimelines()):(this.addListeners(),this.registerTimelines(),this.executeAnimations()))}initializeDoubleClick(){if("undefined"==typeof Enabler)return console.warn("DoubleClick Enabler not found, falling back to generic initialization"),this.addListeners(),void this.executeAnimations();Enabler.isInitialized()?this.onEnablerInit():Enabler.addEventListener(studio.events.StudioEvent.INIT,()=>{this.onEnablerInit()}),Enabler.isPageLoaded()?this.onPageLoaded():Enabler.addEventListener(studio.events.StudioEvent.PAGE_LOADED,()=>{this.onPageLoaded()}),this.expand&&this.setupExpandableAd()}onEnablerInit(){this.addListeners()}onPageLoaded(){Enabler.isVisible()?this.executeAnimations():Enabler.addEventListener(studio.events.StudioEvent.VISIBLE,()=>{this.executeAnimations()})}setupExpandableAd(){if("in-app"!==this.bannerType){const[e,t,i,n]=this.finalExpandSize;0===e&&0===t&&0===i&&0===n?console.warn("Please add final expand size banner"):Enabler.setExpandingPixelOffsets(e,t,i,n,!1,!1)}Enabler.setStartExpanded(this.startExpanded),Enabler.addEventListener(studio.events.StudioEvent.EXPAND_START,()=>{"function"==typeof this.timelinesToRegister.expandStartAnimation&&this.timelinesToRegister.expandStartAnimation(),Enabler.finishExpand()}),Enabler.addEventListener(studio.events.StudioEvent.EXPAND_FINISH,()=>{"function"==typeof this.timelinesToRegister.expandFinishAnimation&&this.timelinesToRegister.expandFinishAnimation()}),Enabler.addEventListener(studio.events.StudioEvent.COLLAPSE_START,()=>{"function"==typeof this.timelinesToRegister.collapseStartAnimation&&this.timelinesToRegister.collapseStartAnimation(),Enabler.finishCollapse()}),Enabler.addEventListener(studio.events.StudioEvent.COLLAPSE_FINISH,()=>{"function"==typeof this.timelinesToRegister.collapseFinishAnimation&&this.timelinesToRegister.collapseFinishAnimation()}),document.body.className=Enabler.getOrientation().getMode(),Enabler.addEventListener(studio.events.StudioEvent.ORIENTATION,()=>{document.body.className=Enabler.getOrientation().getMode()})}collapseEvent(){"undefined"!=typeof Enabler?(Enabler.reportManualClose(),Enabler.requestCollapse()):super.collapseEvent()}expandEvent(){"undefined"!=typeof Enabler?Enabler.requestExpand():super.expandEvent()}}class n{static setMask(e){const t=document.querySelector(e.container);if(!t)return void console.warn(`FadedMask: Container "${e.container}" not found`);const{imageUrl:i,imageWidth:n,imageHeight:s,maskWidth:o,maskClass:a,direction:l="left-right"}=e,r="top-bottom"===l||"bottom-top"===l,d=Math.floor(r?s/o:n/o),c=[];for(let e=0;e<d;e++){const t=this.getSliceStyle(l,e,i,n,s,o);c.push(`<div class="${a}" style="${t}"></div>`)}t.innerHTML=c.join("")}static getSliceStyle(e,t,i,n,s,o){const a=`background-image: url(${i}); background-repeat: no-repeat; position: absolute;`;switch(e){case"left-right":default:return`${a} background-position: ${-o*t}px 0px; top: 0px; left: ${o*t}px; width: ${o}px; height: ${s}px;`;case"right-left":return`${a} background-position: ${o*(t+1)}px 0px; top: 0px; left: ${n-o*(t+1)}px; width: ${o}px; height: ${s}px;`;case"top-bottom":return`${a} background-position: 0px ${-o*t}px; top: ${o*t}px; left: 0px; width: ${n}px; height: ${o}px;`;case"bottom-top":return`${a} background-position: 0px ${o*(t+1)}px; top: ${s-o*(t+1)}px; left: 0px; width: ${n}px; height: ${o}px;`}}}const s={setMask:e=>n.setMask(e)};e.Banner=i,e.BaseBanner=t,e.FadedMask=n,e.GenericBanner=class extends t{constructor(e={}){super(e)}initializeBanner(e){this.initialized?console.log("Already initialized"):(this.setConfig(e),this.addListeners(),this.registerTimelines())}registerTimelines(){super.registerTimelines(),this.executeAnimations()}},e.PoliteBanner=class extends i{constructor(e={}){super({...e,autoInit:!1}),this.politeLoaded=!1,window.addEventListener("load",()=>{this.initializeBanner(e)})}initializeBanner(e){this.initialized?console.log("Already initialized"):(this.setConfig(e),this.doubleClickTracking?(this.initializePoliteDoubleClick(),this.registerTimelines()):(this.addListeners(),this.registerTimelines(),this.executeAnimations()))}initializePoliteDoubleClick(){if("undefined"==typeof Enabler)return console.warn("DoubleClick Enabler not found, falling back to generic initialization"),this.addListeners(),void this.executeAnimations();Enabler.isInitialized()?this.onEnablerInit():Enabler.addEventListener(studio.events.StudioEvent.INIT,()=>{this.onEnablerInit()}),Enabler.isPageLoaded()?this.onPoliteLoaded():Enabler.addEventListener(studio.events.StudioEvent.PAGE_LOADED,()=>{this.onPoliteLoaded()}),this.expand&&this.setupExpandableAd()}onPoliteLoaded(){this.politeLoaded=!0,"undefined"==typeof Enabler||Enabler.isVisible()?this.executeAnimations():Enabler.addEventListener(studio.events.StudioEvent.VISIBLE,()=>{this.executeAnimations()})}isPoliteLoaded(){return this.politeLoaded}},e.Stats=class{#e=null;#t=[];#i=null;#n={};#s={initX:0,initY:0,mousePressX:0,mousePressY:0};constructor(e=null){this.#i=e,window.addEventListener("load",()=>{this.initializeStats()})}initializeStats(){this.buildStats(),this.cacheElements(),this.addHoverEffects(),this.setTimeline()}setTimeline(){const e=this.#i||window.banner;e?(this.#i=e,this.#t=e.timelinesArray||[],0!==this.#t.length?(this.#e=this.#t[0],this.registerEventHandlers(),this.fillTimelinesSelect()):console.warn("Stats: No timelines found in banner")):console.warn("Stats: No banner instance found")}buildStats(){const e=document.querySelector(".banner");if(!e)return void console.warn("Stats: No .banner element found");const t=document.createElement("div");t.id="stats",Object.assign(t.style,{width:"300px",height:"130px",backgroundColor:"#ccc",position:"fixed",bottom:"0",right:"0",opacity:"0.5",borderRadius:"10px",zIndex:"9999"}),t.addEventListener("mouseover",()=>{t.style.opacity="1"}),t.addEventListener("mouseout",()=>{t.style.opacity="0.5"}),t.innerHTML='\n      <p id="currenttime" style="font-family: Arial, sans-serif; color: #666; font-size: 30px; position: absolute; bottom: 85px; left: 14px; opacity: 0.5; margin: 0;">00.00</p>\n      <p id="totaltime" style="font-family: Arial, sans-serif; color: #666; font-size: 20px; position: absolute; bottom: 88px; left: 101px; opacity: 0.5; margin: 0;">00.00</p>\n      <input id="slider-timeline" type="range" min="0" step="0.01" max="274" value="0" style="position: absolute; bottom: 60px; width: 274px; left: 10px;">\n      <select id="flags" style="position: absolute; bottom: 20px; right: 14px; width: 120px;"></select>\n      <select id="timelines" style="position: absolute; bottom: 90px; right: 14px; width: 120px;"></select>\n      <span id="play" style="font-family: Arial, sans-serif; color: #fff; font-size: 16px; position: absolute; bottom: 10px; left: 14px; cursor: pointer; background-color: #999; padding: 10px 8px; border-radius: 10px; width: 46px; text-align: center;">Play</span>\n      <span id="restart" style="font-family: Arial, sans-serif; color: #fff; font-size: 16px; position: absolute; bottom: 10px; left: 84px; cursor: pointer; background-color: #999; padding: 10px 8px; border-radius: 10px;">Restart</span>\n    ',e.parentNode.insertBefore(t,e.nextSibling)}cacheElements(){this.#n={statDiv:document.getElementById("stats"),playButton:document.getElementById("play"),restartButton:document.getElementById("restart"),sliderTimeline:document.getElementById("slider-timeline"),selectFlags:document.getElementById("flags"),selectTimelines:document.getElementById("timelines"),totalTimeDisplay:document.getElementById("totaltime"),currentTimeDisplay:document.getElementById("currenttime")}}addHoverEffects(){const{playButton:e,restartButton:t}=this.#n;e&&(e.addEventListener("mouseover",()=>{e.style.backgroundColor="#666666"}),e.addEventListener("mouseout",()=>{e.style.backgroundColor="#999999"})),t&&(t.addEventListener("mouseover",()=>{t.style.backgroundColor="#666666"}),t.addEventListener("mouseout",()=>{t.style.backgroundColor="#999999"}))}registerEventHandlers(){const{statDiv:e,playButton:t,restartButton:i,selectFlags:n,selectTimelines:s,sliderTimeline:o}=this.#n;e&&e.addEventListener("mousedown",e=>this.handleDragStart(e)),t&&t.addEventListener("click",()=>this.togglePlay()),i&&i.addEventListener("click",()=>this.restartTimeline()),n&&n.addEventListener("change",()=>this.goToLabel()),s&&s.addEventListener("change",()=>this.switchTimeline()),o&&(o.addEventListener("input",()=>this.scrubTimeline()),o.addEventListener("change",()=>this.scrubTimeline()))}handleDragStart(e){const{statDiv:t,sliderTimeline:i}=this.#n;if(e.target===i)return;this.#s={initX:t.offsetLeft,initY:t.offsetTop,mousePressX:e.clientX,mousePressY:e.clientY};const n=e=>this.handleDragMove(e);t.addEventListener("mousemove",n),window.addEventListener("mouseup",()=>{t.removeEventListener("mousemove",n),t.style.cursor="default"},{once:!0})}handleDragMove(e){const{statDiv:t}=this.#n,{initX:i,initY:n,mousePressX:s,mousePressY:o}=this.#s;t.style.cursor="move",t.style.left=i+e.clientX-s+"px",t.style.top=n+e.clientY-o+"px",t.style.right="auto",t.style.bottom="auto"}togglePlay(){const{playButton:e}=this.#n;this.#e&&(this.#e.paused()?(this.#e.totalDuration()===this.#e.time()?this.#e.restart():this.#e.play(),e.textContent="Pause"):(this.#e.pause(),e.textContent="Play"))}restartTimeline(){this.#e&&this.#e.restart()}goToLabel(){const{selectFlags:e}=this.#n;if(this.#e&&e){const t=e.options[e.selectedIndex].text;this.#e.seek(t).play()}}scrubTimeline(){const{sliderTimeline:e,currentTimeDisplay:t}=this.#n;this.#e&&e&&(this.#e.seek(parseFloat(e.value)),t.textContent=this.#e.time().toFixed(2))}switchTimeline(){const{selectTimelines:e,sliderTimeline:t}=this.#n;if(!e)return;this.#e&&this.#e.seek(0);const i=e.options[e.selectedIndex].value;this.#e=this.#t[parseInt(i,10)],t&&(t.value="0"),this.updateTimelineDisplay()}fillTimelinesSelect(){const{selectTimelines:e}=this.#n,t=this.#i;if(!e||!t)return;const i=(t.timelinesName||[]).map((e,t)=>`<option value="${t}">${e}</option>`).join("");e.innerHTML=i;for(const e of this.#t)e.eventCallback("onStart",()=>this.handleTimelineStart(e));this.updateTimelineDisplay()}handleTimelineStart(e){const{selectTimelines:t}=this.#n;this.#e=e;const i=this.#t.indexOf(e);t&&i>=0&&(t.selectedIndex=i),this.updateTimelineDisplay()}updateTimelineDisplay(){const{selectFlags:e,currentTimeDisplay:t,totalTimeDisplay:i,sliderTimeline:n}=this.#n;if(this.#e){if(e){const t=(this.#e.getLabelsArray?.()||[]).map(e=>`<option value="${e.time}">${e.name}</option>`).join("");e.innerHTML=t}t&&(t.textContent=this.#e.time().toFixed(2)),i&&(i.textContent=this.#e.totalDuration().toFixed(2)),n&&(n.max=this.#e.totalDuration().toFixed(2)),this.#e.eventCallback("onUpdate",()=>this.handleTimelineUpdate()),this.#e.eventCallback("onComplete",()=>this.handleTimelineComplete())}}handleTimelineUpdate(){const{currentTimeDisplay:e,sliderTimeline:t,playButton:i}=this.#n;if(!this.#e)return;const n=this.#e.time().toFixed(2);e&&(e.textContent=n),t&&(t.value=n),i&&(i.textContent="Pause")}handleTimelineComplete(){const{playButton:e}=this.#n;e&&(e.textContent="Play"),this.#e&&this.#e.pause()}getCurrentTimeline(){return this.#e}setBanner(e){this.#i=e,this.setTimeline()}},e.fadedMask=s});
